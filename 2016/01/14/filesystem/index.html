<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>node.js文件系统API详解 - SimpleZn&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="文件权限说明，目录操作常用方法介绍，文件操作常用方法介绍，适用于两个的方法介绍，文件路径API……">
<meta property="og:type" content="article">
<meta property="og:title" content="node.js文件系统API详解">
<meta property="og:url" content="http://yoursite.com/2016/01/14/filesystem/index.html">
<meta property="og:site_name" content="SimpleZn's Blog">
<meta property="og:description" content="文件权限说明，目录操作常用方法介绍，文件操作常用方法介绍，适用于两个的方法介绍，文件路径API……">
<meta property="og:updated_time" content="2016-01-15T07:18:45.743Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="node.js文件系统API详解">
<meta name="twitter:description" content="文件权限说明，目录操作常用方法介绍，文件操作常用方法介绍，适用于两个的方法介绍，文件路径API……">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://yoursite.com"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-filesystem" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      node.js文件系统API详解
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/01/14/filesystem/" class="article-date">
  <time datetime="2016-01-13T16:00:00.000Z" itemprop="datePublished">2016-01-14</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/node-js/">node.js</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>文件权限说明，目录操作常用方法介绍，文件操作常用方法介绍，适用于两个的方法介绍，文件路径API<br>……<br><a id="more"></a></p>
<h3 id="Linux_u6587_u4EF6_u7528_u6237_u6743_u9650_u8BF4_u660E"><a href="#Linux_u6587_u4EF6_u7528_u6237_u6743_u9650_u8BF4_u660E" class="headerlink" title="Linux文件用户权限说明"></a>Linux文件用户权限说明</h3><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">-rw-r--r--  1 root  wheel  5021  9 10  2014 periodic.conf</span><br></pre></td></tr></table></figure>
<p>第一位：-表示文件（为d时，表示目录）<br><br>第二、三、四位：表示文件所有者的读、写、执行权限（此例中表示文件所有者有读和写权限，没有执行权限）<br><br>第五、六、七位：表示文件所有者所在组的读、写、执行权限（此例中表示：同组用户具有读权限，没有写和执行的权限）<br><br>第八、九、十位：表示其他的读、写、执行权限（此例中表示：其他用户只有读权限，没有写和执行权限）</p>
<ul>
<li>r表示读取权限，对应数字值为4</li>
<li>w表示写入权限，对应数字值为2</li>
<li><p>x表示执行权限，对应数字值为1</p>
<p>要赋予读、写、执行权限，即：rwx，则4+2+1=7<br><br>要赋予读、写权限，即：rw-，则4+2=6<br><br>要赋予读、执行权限，即r-x，则4+1=5<br></p>
</li>
</ul>
<h3 id="u76EE_u5F55_u64CD_u4F5C"><a href="#u76EE_u5F55_u64CD_u4F5C" class="headerlink" title="目录操作"></a>目录操作</h3><p>1、<strong>fs.mkdir创建目录</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.mkdir(path[, mode], callback)</span><br></pre></td></tr></table></figure></p>
<p>fs.mkdir()方法用于创建目录，fs.mkdirsync(path[, mode])是其同步方法<br></p>
<p>mode默认值是0777</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.mkdir(<span class="string">'test'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(err);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>2、<strong>fs.readdir读取目录</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.readdir(path, callback)</span><br></pre></td></tr></table></figure></p>
<p>用于读取目录内容， fs.readdirSync<br></p>
<p>回调函数callback(err, files), files是除了表示本目录的’.’和表示上级目录的’..’外的所有文件和目录的一个数组</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.readdir(<span class="string">'test'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, files</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(err);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line">	<span class="built_in">console</span>.log(files);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3、<strong>fs.rmdir()删除空目录</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.rmdir(path, callback)</span><br></pre></td></tr></table></figure></p>
<p>删除目录， fs.rmdirSync(path)<br><br>回调函数callback(err)接受一个参数err,表示其可能出现的异常，当目录非空，路径错误，非目录时异常会发生</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.rmdir(<span class="string">'needremove'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;</span><br><span class="line">		<span class="built_in">console</span>.log(err);</span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="u6587_u4EF6_u64CD_u4F5C"><a href="#u6587_u4EF6_u64CD_u4F5C" class="headerlink" title="文件操作"></a>文件操作</h3><p>1、<strong>fs.open文件打开</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.open(path, flags, [mode], callback)</span><br></pre></td></tr></table></figure></p>
<p>文件打开，fs.openSync(path, flags, [mode]) <br></p>
<p>flags（常用）:</p>
<ul>
<li>‘r’  以【只读】方式打开文件，当文件不存在时产生异常</li>
<li>‘r+’ 以【读写】方式打开文件，当文件不存在时产生异常</li>
<li>‘w’  以【只写】的形式打开文件. 文件会被创建 (如果文件不存在) 或者覆盖 (如果存在).</li>
<li>‘w+’ 以【读写】的方式打开文件. 文件会被创建 (如果文件不存在) 或者覆盖 (如果存在).</li>
<li>‘a’  以【附加】的形式打开文件，即新写入的数据会附加在原来的文件内容之后. 如果文件不存在则会默认创建.</li>
</ul>
<p>mode用于设置文件模式<br></p>
<p>callback接受两个参数(err, fd)</p>
<p>fd - 文件描述符</p>
<p>2、<strong>fs.read读取文件数据</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.read(fd, buffer, offset, length, position, callback)</span><br></pre></td></tr></table></figure></p>
<ul>
<li>从文件描述符fd中读取文件数据</li>
<li>buffer是一个缓冲区，去读的数据将会写入到这里</li>
<li>offset是开始向缓冲区写入数据时的偏移量</li>
<li>length是一个整型值，指定了读取的字节数</li>
<li>position是一个整型值，指读取的文件的起始位置，如果position为null，将会从文件当前的位置读取数据</li>
</ul>
<p>使用fs.read()方法读取文件内容时，首先需要一个文件描述符fd，创建文件描述符fs可以用fs.open()方法。 <br></p>
<p>fs.read()可以实现部分文件内容的读取，通过length和position参数可以指定读取文件内容的长度和起始位置。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.open(<span class="string">'123.txt'</span>, <span class="string">'r'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) &#123;</span><br><span class="line">		<span class="built_in">console</span>.error(err);</span><br><span class="line">		<span class="keyword">return</span>;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="keyword">var</span> buf = <span class="keyword">new</span> Buffer(<span class="number">8</span>);</span><br><span class="line">	fs.read(fd, buf, <span class="number">0</span>, <span class="number">8</span>, <span class="literal">null</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, bytesRead, buffer</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) &#123;</span><br><span class="line">			<span class="built_in">console</span>.log(err);</span><br><span class="line">			<span class="keyword">return</span>;</span><br><span class="line">		&#125;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'bytesRead : '</span> + bytesRead);</span><br><span class="line">		<span class="built_in">console</span>.log(buffer.toString());</span><br><span class="line">		<span class="built_in">console</span>.log(buffer);</span><br><span class="line">	&#125;)</span><br><span class="line"></span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>3、<strong>fs.readFile读取文件内容</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.readFile(fileName, [options], callback)</span><br></pre></td></tr></table></figure></p>
<p>读取文件的全部内容</p>
<ul>
<li>filename - string</li>
<li>options - Object<ol>
<li>encoding  { String | Null } default = null</li>
<li>flag { String } default = ‘r’</li>
</ol>
</li>
<li>callback {err, data}</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.readFile(<span class="string">'123.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, data</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'buffer raw: '</span>, data);</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'buffer string: '</span>, data.toString());</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure>
<p>如果未指定编码方式，原生buffer就会被返回。</p>
<p>不需要fd文件描述符。</p>
<p>4、<strong>fs.write将数据写入到文件</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.write(fd, buffer, offset, length[, position], callback)&#10;fs.write(fd, data, [position, [encoding]], callback)</span><br></pre></td></tr></table></figure></p>
<p>fs.write()上面有两种形式，可以将一个buffer或data字符串写入到文件描述符fs指定的文件中</p>
<ul>
<li>data 是要写入文件的字符串，（当写入数据不是Buffer时，将会被转为字符串）</li>
<li>callback(err, written, buffer)</li>
</ul>
<p>fs.write在没有等待回调而多次操作同一个文件是不安全的。在这种情况下，强烈推荐使用fs.createWriteStream方法。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line">fs.open(<span class="string">'./myWriteFile.txt'</span>, <span class="string">'w'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, fd</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="keyword">var</span> writeBuffer = <span class="keyword">new</span> Buffer(<span class="string">'content will be written to my write file.'</span>);</span><br><span class="line">	fs.write(fd, writeBuffer, <span class="number">0</span>, writeBuffer.length, <span class="number">0</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, written, buffer</span>) </span>&#123;</span><br><span class="line">		<span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">		<span class="built_in">console</span>.log(buffer);</span><br><span class="line">		<span class="built_in">console</span>.log(buffer.toString());</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>5、<strong>fs.writeFile()将buffer或者字符串写入到文件</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.wirteFile(filename, data[, options], callback)</span><br></pre></td></tr></table></figure></p>
<p>将一个buffer或者字符串写入到指定的文件中，当文件已经存在时，文件内容会被替换</p>
<ul>
<li>filename {String}</li>
<li>data {String | Buffer}</li>
<li>options {Object}<ol>
<li>encoding {String | Null} default = ‘utf8’</li>
<li>mode {Number} default = 438 (aka 0666 in Octal)</li>
<li>flag {String} default = ‘w’</li>
</ol>
</li>
<li>callback {Function}</li>
</ul>
<p>区别： 不需要描述符</p>
<p>6、<strong>fs.readpath获取文件的绝对路径</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">fs.realpath('./testFile.txt', function(err, resolvedPath) [</span><br><span class="line">    if (err) throw err;</span><br><span class="line">    console.log('文件的绝对路径是: ', resolvedPath);</span><br><span class="line">])</span><br></pre></td></tr></table></figure></p>
<h3 id="Both_uFF08_u6587_u4EF6_u6216_u8005_u76EE_u5F55_u64CD_u4F5C_uFF09"><a href="#Both_uFF08_u6587_u4EF6_u6216_u8005_u76EE_u5F55_u64CD_u4F5C_uFF09" class="headerlink" title="Both（文件或者目录操作）"></a>Both（文件或者目录操作）</h3><p>1、<strong>fs.rename重命名</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.rename(oldPath, newPath, callback)</span><br></pre></td></tr></table></figure></p>
<p>文件重命名或者移动，也可以用于目录操作</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> path = <span class="built_in">require</span>(<span class="string">'path'</span>);</span><br><span class="line"></span><br><span class="line">fs.rename(<span class="string">'testFile.txt'</span>, <span class="string">'test/testNewFile.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'文件移动成功.'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">fs.rename(<span class="string">'testFile.txt'</span>, <span class="string">'testnewFile.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span>(err) <span class="keyword">throw</span> err;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'rename done.'</span>);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<p>2、<strong>fs.exists检查文件/目录是否存在</strong><br><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">fs.exists('./testFile.txt', function(exists) [</span><br><span class="line">    console.log('testFile.txt是否存在:', exists);</span><br><span class="line">]);</span><br></pre></td></tr></table></figure></p>
<p>3、fs.chmod修改文件/目录的读取权限<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.chmod(path, mode, callback)</span><br></pre></td></tr></table></figure></p>
<p>0600表示所有者可读写，其他人不可<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">fs.chmod(<span class="string">'./testFile.txt'</span>, <span class="number">0600</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'修改失败'</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'修改成功'</span>)</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure></p>
<p>4、fs.fstat查看文件/目录信息<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">fs.stat(<span class="string">'testFile.txt'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err, stats</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (err) &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'读取文件信息失败'</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// status是一个Fs.Stats对象</span></span><br><span class="line">    <span class="built_in">console</span>.log(stats);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'是否为文件: '</span>, stats.isFile);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'是否为目录: '</span>, stats.isDirectory);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'读写权限是: '</span>, stats.mode);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'文件大小是: '</span>, stats.size);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'访问时间是: '</span>, stats.atime);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'修改时间是: '</span>, stats.mtime);</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'创建时间是: '</span>, stats.ctime);</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p>
<h3 id="u57FA_u4E8E_u6D41_u7684_u6587_u4EF6_u5904_u7406"><a href="#u57FA_u4E8E_u6D41_u7684_u6587_u4EF6_u5904_u7406" class="headerlink" title="基于流的文件处理"></a>基于流的文件处理</h3><p>1、<strong>fs.createReadStream创建可读流</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.createReadStream(path[, options])</span><br></pre></td></tr></table></figure></p>
<p>读取指定文件，并返回一个ReadStream对象</p>
<ul>
<li>path是要创建可读流的文件的路径</li>
<li><p>options</p>
<ol>
<li>flags: ‘r’,</li>
<li>encoding: null,</li>
<li>fd: null,</li>
<li>mode: 0666,</li>
<li>autoClose: true</li>
</ol>
<p>start end 用于读取文件内的特定范围</p>
<p>如果 autoClose 为 false 则即使在发生错误时也不会关闭文件描述符 (file descriptor)。 此时你需要负责关闭文件，避免文件描述符泄露 (leak)。 如果 autoClose 为 true （缺省值）， 当发生 error 或者 end 事件时，文件描述符会被自动释放。</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"> <span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> fileStream = fs.createReadStream(<span class="string">'./testFile.txt'</span>);</span><br><span class="line"><span class="keyword">var</span> body = <span class="string">''</span>;</span><br><span class="line">fileStream.on(<span class="string">'open'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">fd</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'文件被打开，开始读取...'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">fileStream.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'正在去读数据...'</span>);</span><br><span class="line">	body += data;</span><br><span class="line">&#125;);</span><br><span class="line">fileStream.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'文件读取完毕...'</span>);</span><br><span class="line">	<span class="built_in">console</span>.log(body);</span><br><span class="line">&#125;);</span><br><span class="line">fileStream.on(<span class="string">'close'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'文件已关闭...'</span>);</span><br><span class="line">&#125;);</span><br><span class="line">fileStream.on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">	<span class="built_in">console</span>.log(<span class="string">'文件读取出错...'</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">// 手动暂停/恢复读取文件</span></span><br><span class="line"><span class="comment">// file.pause()</span></span><br><span class="line"><span class="comment">// file.resume()</span></span><br><span class="line"><span class="comment">//</span></span><br></pre></td></tr></table></figure>
<p>2、<strong>fs.createWriteStream创建可写流</strong></p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">fs.createWriteStream(path[, options])</span><br></pre></td></tr></table></figure>
<p>创建一个WriteStream对象</p>
</li>
<li><p>options(缺省)</p>
<ol>
<li>flags: ‘w’,</li>
<li>encoding: null,</li>
<li>mode: 0666</li>
</ol>
</li>
</ul>
<p>options 也可以包含一个 start 选项用于指定在文件中开始写入数据的位置。 修改而不替换文件需要 flags 的模式指定为 r+ 而不是默值的 w.</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> fs = <span class="built_in">require</span>(<span class="string">'fs'</span>);</span><br><span class="line"><span class="keyword">var</span> file1 = fs.createReadStream(<span class="string">'file1.txt'</span>);</span><br><span class="line"><span class="keyword">var</span> file2 = fs.createWriteStream(<span class="string">'file2.txt'</span>, &#123;flags: <span class="string">'r+'</span>&#125;);</span><br><span class="line"></span><br><span class="line">file1.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">	file2.write(data);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">file1.on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">err</span>) </span>&#123;</span><br><span class="line">	<span class="keyword">if</span> (err) <span class="keyword">throw</span> err;</span><br><span class="line">	file2.end(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'文件写入完成'</span>);</span><br><span class="line">		<span class="built_in">console</span>.log(<span class="string">'共写入 %d 字节数据'</span>, file2.bytesWritten);</span><br><span class="line">	&#125;);</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>
<h3 id="u5904_u7406_u6587_u4EF6_u8DEF_u5F84"><a href="#u5904_u7406_u6587_u4EF6_u8DEF_u5F84" class="headerlink" title="处理文件路径"></a>处理文件路径</h3><p>1、<strong>path.normalize(p)</strong><br>规范化字符串路径</p>
<p>多个斜杠会被替换成一个 路径末尾的斜杠会被保留  Windows 系统上, 会使用反斜杠。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.normalize(&#39;/foo/bar//baz/asdf/quux/..&#39;)&#10;// returns&#10;&#39;/foo/bar/baz/asdf&#39;</span><br></pre></td></tr></table></figure>
<p>2、<strong>path.join连接路径</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.join([path1], [path2], [...])</span><br></pre></td></tr></table></figure></p>
<p>连接所有参数, 并且规范化得到的路径。参数必须是字符串。</p>
<p>3、<strong>path.resolve路径解析</strong><br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">path.resolve([from ...], to)</span><br></pre></td></tr></table></figure></p>
<p>把 to 解析为一个绝对路径。</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/fs/">fs</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/node/">node</a></li><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/path/">path</a></li></ul>

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
    <a href="/2016/01/15/util/" id="article-nav-newer" class="article-nav-link-wrap">
      <div class="article-nav-title"><span>&lt;</span>&nbsp;
        
          util模块常用工具类
        
      </div>
    </a>
  
  
</nav>

  
</article>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 SimpleZn&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>