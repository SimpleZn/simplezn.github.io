<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  <title>ajax之XMLHttpRequest对象 - SimpleZn&#39;s Blog</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <meta name="description" content="Ajax指的是一种JavaScript在浏览器中的使用方法。它通过原生的XMLHttpRequest对象发出HTTP请求，得到服务器返回的数据后，再进行处理。
XMLHttpRequest对象XMLHttpRequest对象用来在浏览器与服务器之间传送数据。XMLHttpRequest可以报送各种数据，包括字符串和二进制，而且除了HTTP，它还支持通过其他协议传送（比如File和FTP）。">
<meta property="og:type" content="article">
<meta property="og:title" content="ajax之XMLHttpRequest对象">
<meta property="og:url" content="http://simplezn.site/2016/02/24/ajax之XMLHttpRequest对象/index.html">
<meta property="og:site_name" content="SimpleZn's Blog">
<meta property="og:description" content="Ajax指的是一种JavaScript在浏览器中的使用方法。它通过原生的XMLHttpRequest对象发出HTTP请求，得到服务器返回的数据后，再进行处理。
XMLHttpRequest对象XMLHttpRequest对象用来在浏览器与服务器之间传送数据。XMLHttpRequest可以报送各种数据，包括字符串和二进制，而且除了HTTP，它还支持通过其他协议传送（比如File和FTP）。">
<meta property="og:updated_time" content="2016-03-04T08:15:42.487Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="ajax之XMLHttpRequest对象">
<meta name="twitter:description" content="Ajax指的是一种JavaScript在浏览器中的使用方法。它通过原生的XMLHttpRequest对象发出HTTP请求，得到服务器返回的数据后，再进行处理。
XMLHttpRequest对象XMLHttpRequest对象用来在浏览器与服务器之间传送数据。XMLHttpRequest可以报送各种数据，包括字符串和二进制，而且除了HTTP，它还支持通过其他协议传送（比如File和FTP）。">
  
  
    <link rel="icon" href="/favicon.png">
  
  <link href="/webfonts/ptserif/main.css" rel='stylesheet' type='text/css'>
  <link href="/webfonts/source-code-pro/main.css" rel="stylesheet" type="text/css">
  <link rel="stylesheet" href="/css/style.css" type="text/css">
  

</head>

<body>
  <div id="container">
    <header id="header">
  <div id="header-outer" class="outer">
    <div id="header-inner" class="inner">
      <a id="main-nav-toggle" class="nav-icon" href="javascript:;"></a>
      
      <nav id="main-nav">
        
          <a class="main-nav-link" href="/">主页</a>
        
          <a class="main-nav-link" href="/archives">归档</a>
        
      </nav>
      <nav id="sub-nav">
        <div id="search-form-wrap">
          <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" results="0" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://simplezn.site"></form>
        </div>
      </nav>
    </div>
  </div>
</header>
    <section id="main" class="outer"><article id="post-ajax之XMLHttpRequest对象" class="article article-type-post" itemscope itemprop="blogPost">
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 class="article-title" itemprop="name">
      ajax之XMLHttpRequest对象
    </h1>
  

      </header>
    
    <div class="article-meta">
      <a href="/2016/02/24/ajax之XMLHttpRequest对象/" class="article-date">
  <time datetime="2016-02-23T16:00:00.000Z" itemprop="datePublished">2016-02-24</time>
</a>
      
  <div class="article-category">
    <a class="article-category-link" href="/categories/JavaScript/">JavaScript</a>
  </div>

      
    </div>
    <div class="article-entry" itemprop="articleBody">
      
        <p>Ajax指的是一种JavaScript在浏览器中的使用方法。它通过原生的XMLHttpRequest对象发出HTTP请求，得到服务器返回的数据后，再进行处理。</p>
<h3 id="XMLHttpRequest_u5BF9_u8C61"><a href="#XMLHttpRequest_u5BF9_u8C61" class="headerlink" title="XMLHttpRequest对象"></a>XMLHttpRequest对象</h3><p>XMLHttpRequest对象用来在浏览器与服务器之间传送数据。XMLHttpRequest可以报送各种数据，包括字符串和二进制，而且除了HTTP，它还支持通过其他协议传送（比如File和FTP）。</p>
<a id="more"></a>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// 新建一个XMLHttpRequest对象</span></span><br><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line"><span class="comment">// 指定通信状态变化时的回调</span></span><br><span class="line">xhr.onreadystatechange = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="comment">// 通信成功时，状态值为4</span></span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(xhr.responseText);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(xhr.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xhr.onerror = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(xhr.statusText);</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// open方式用于指定HTTP动词、请求的网址、是否同步</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'/endpoint'</span>, <span class="literal">true</span>);</span><br><span class="line"><span class="comment">// 发送http请求</span></span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure>
<h3 id="XMLHttpRequest_u5B9E_u4F8B_u5C5E_u6027"><a href="#XMLHttpRequest_u5B9E_u4F8B_u5C5E_u6027" class="headerlink" title="XMLHttpRequest实例属性"></a>XMLHttpRequest实例属性</h3><p>1、<strong>readyState</strong></p>
<p>readyState只读属性，用一个整数和对应的常量，表示XMLHttpRequest请求当前所在的状态。</p>
<ul>
<li>0 -&gt; UNSENT, 表示XMLHttpRequest实例已经生成，但是还没有调用open。</li>
<li>1 -&gt; OPENED, 表示send()方法还没有被调用，这时还可以调用setRequestHeader(), 设定HTTP请求的头信息。</li>
<li>2 -&gt; HEADERS_RECEIVED, 表示send()方法已经执行，并且头信息和状态吗已经收到。</li>
<li>3 -&gt; LOADING, 表示正在接收服务器传来的body部分的数据，如果responseType属性时text或者空字符串，responseText就会包含已经收到的信息。</li>
<li>4 -&gt; DONE, 表示服务器数据已经完全接收，或者本次接收已经失败了。</li>
</ul>
<p>在通信过程中，每当发生状态变化的时候，readyState属性的值就会发生改变。这个值每一次变化，都会触发readyStateChange事件。</p>
<p>2、<strong>response</strong></p>
<p>只读，返回接收到的数据体(即body部分)。它的类型可以是ArrayBuffer、Blob、Document、JSON对象、或者一个字符串。</p>
<p>3、<strong>responseType</strong></p>
<p>指定服务器返回数据（xhr.response）的类型。</p>
<ul>
<li>“” 字符串(默认值)</li>
<li>“arraybuffer” ArrayBuffer对象</li>
<li>“blob” Blob对象</li>
<li>“document”  Document对象</li>
<li>“json” JSON对象</li>
<li>“text” 字符串</li>
</ul>
<p>text类型适合大多数情况，而且直接处理文本也比较方便，document类型适合返回XML文档的情况，blob类型适合读取二进制数据，比如图片文件。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'/path/to/image.png'</span>, <span class="literal">true</span>);</span><br><span class="line">xhr.responseType = <span class="string">'blob'</span>;</span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params">e</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="keyword">this</span>.status == <span class="number">200</span>) &#123;</span><br><span class="line">        <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([<span class="keyword">this</span>.response], &#123;type: <span class="string">'image/png'</span>&#125;);</span><br><span class="line">        <span class="comment">// 或者</span></span><br><span class="line">        <span class="keyword">var</span> blob = oReq.response;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xhr.send();</span><br></pre></td></tr></table></figure></p>
<p>如果将这个属性设为’json’, 支持JSON的浏览器，就会自动对返回数据调用JSON.parse()方法。也就是说你从xhr.response属性得到的不是文本，而是一个JSON对象。</p>
<p>4、<strong>responseText</strong></p>
<p>只读，返回接收到的字符串。如果本次请求没有成功或者数据不完整，该属性就会等于<code>null</code>。</p>
<p>5、<strong>responseXML</strong></p>
<p>responseXML属性为只读，返回接收到的Document对象。<br>返回的数据会被解析为text/xml类型的数据流。如果responseType设为document，且这个请求是异步的，则返回的数据会被解析为text/html数据流。</p>
<p>6、<strong>status</strong></p>
<p>属性为只读属性，表示本次请求得到的HTTP状态码，它是一个整数。</p>
<p>7、<strong>statusText</strong></p>
<p>属性为只读属性，返回一个字符串，表示服务器发送的状态提示。不同于status属性，该属性包含整个状态信息，比如‘200 OK’</p>
<p>8、<strong>timeout</strong></p>
<p>整数，表示多少毫秒后，如果请求仍然没有得到结果，就会自动终止。如果该属性等于0， 就表示没有时间限制。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> xhr = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">xhr.ontimeout = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.error(<span class="string">'The request for '</span> + url + <span class="string">' timed out.'</span>)</span><br><span class="line">&#125;;</span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="string">`callback`</span>.apply(xhr, args);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="built_in">console</span>.error(xhr.statusText);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line">xhr.open(<span class="string">'GET'</span>, url, <span class="literal">true</span>);</span><br><span class="line">xhr.timeout = timeout;</span><br><span class="line">xhr.send(<span class="literal">null</span>);</span><br></pre></td></tr></table></figure>
<p>9、<strong>ontimeout</strong></p>
<p>ontimeout属性指向一个回调函数，发生timeout事件时，该函数会被调用。</p>
<hr>
<p>###XMLHttpRequest实例方法<br>1、<strong>abort</strong></p>
<p>用来终止已经发出的HTTP请求</p>
<p>2、<strong>getAllResponseHeaders</strong></p>
<p>getAllResponseHeaders方法返回服务器发来的所有HTTP头信息、格式为字符串。</p>
<p>3、<strong>getResponseHeader</strong></p>
<p>返回HTTP头信息指定字段的值。</p>
<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">getHeaderTime</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.getResponseHeader(<span class="string">'Last-Modified'</span>));</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> oReq = <span class="keyword">new</span> XMLHttpRequest();</span><br><span class="line">oReq.open(<span class="string">'HEAD'</span>, <span class="string">'yourpage.html'</span>);</span><br><span class="line">oReq.onload = getHeaderTime;</span><br><span class="line">oReq.send();</span><br></pre></td></tr></table></figure>
<p>4、<strong>open</strong></p>
<p>用于指定发送HTTP请求的参数<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">void</span> open(</span><br><span class="line">   string method,</span><br><span class="line">   string url,</span><br><span class="line">   optional boolean <span class="keyword">async</span>,</span><br><span class="line">   optional string user,</span><br><span class="line">   optional string password</span><br><span class="line">);</span><br></pre></td></tr></table></figure></p>
<p>发送post请求：open方法向指定的URL发送POST请求，send方法送出实际的数据。<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">xhr.open(<span class="string">'POST'</span>, endcodeURI(<span class="string">'someURL'</span>));</span><br><span class="line">xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>);</span><br><span class="line">xhr.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line">xhr.send(<span class="built_in">encodeURI</span>(<span class="string">'dataString'</span>));</span><br></pre></td></tr></table></figure></p>
<p>5、<strong>send</strong></p>
<p>用于实际发出的HTTP请求。如果不带参数，就表示HTTP请求只包含头信息，也就是只有一个URL，典型例子就是GET请求；如果带有参数，就表示除了头信息，还带有包含具体数据的信息体，典型例子就是POST请求。</p>
<p>如果请求是异步的（默认为异步），该方法在发出请求后会立即返回。如果请求为同步，该方法只有等到收到服务器回应后，才会返回。</p>
<p>注意，所有XMLHttpRequest的监听事件，都必须在send()方法调用之前设定。</p>
<hr>
<p>###XMLHttpRequest实例事件</p>
<p>1、<strong>readyStateChange事件</strong></p>
<p>readyState属性的值发生改变，就会触发readyStateChange事件。</p>
<p>我们可以通过onReadyStateChange属性，指定这个事件的回调函数，对不同状态进行不同处理。尤其是当状态变为4的时候，表示通信成功，这时回调函数就可以处理服务器传送回来的数据。</p>
<p>2、<strong>progress事件</strong></p>
<p>上传文件时，XMLHTTPRequest对象的upload属性有一个progress，会不断返回上传的进度。</p>
<p>6、<strong>load事件、error事件、abort事件</strong></p>
<p>load事件表示服务器传来的数据接收完毕，error事件表示请求出错，abort事件表示请求被中断。</p>
<p>7、<strong>loadend事件</strong></p>
<p>abort、load和error这三个事件，会伴随一个loadend事件，表示请求结束，但不知道其是否成功。</p>

      
    </div>
    
    
      <footer class="article-footer">
        
  <ul class="article-tag-list"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/JavaScript/">JavaScript</a></li></ul>

      </footer>
    
  </div>
  
    
<nav id="article-nav">
  
  
    <a href="/2016/02/17/js对象之继承/" id="article-nav-older" class="article-nav-link-wrap">
      <div class="article-nav-title">js对象之继承&nbsp;<span>&gt;</span></div>
    </a>
  
</nav>

  
</article>

</section>
    <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      &copy; 2016 SimpleZn&nbsp;
      Powered by <a href="http://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>
    

<script src="/js/jquery.min.js"></script>


  <link rel="stylesheet" href="/fancybox/jquery.fancybox.css" type="text/css">
  <script src="/fancybox/jquery.fancybox.pack.js" type="text/javascript"></script>


<script src="/js/script.js" type="text/javascript"></script>
  </div>
</body>
</html>